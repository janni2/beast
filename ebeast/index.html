<!DOCTYPE html> <!-- GNU LGPL v2.1+: http://www.gnu.org/licenses/lgpl.html -->
<html><head>
  <meta charset="utf-8">

  <title>Beast - Music Synthesizer and Composer</title>

  <!-- Preload resources -->
  <link rel="stylesheet"    href="/assets/stylesheets.css">
  <link rel="stylesheet"    href="/assets/material-icons.css">
  <link rel="stylesheet"    href="/assets/forkawesome-webfont.css">
  <link rel="preload"       href="/assets/Inter-Medium.woff2"        as="font" type="font/woff2" crossorigin>
  <link rel="preload"       href="/assets/forkawesome-webfont.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload"       href="/assets/material-icons.woff2"      as="font" type="font/woff2" crossorigin>
  <link rel="modulepreload" href="/jsbse.js">
  <link rel="modulepreload" href="/bseapi_jsonipc.js">
  <link rel="modulepreload" href="/vue.mjs">
  <link rel="modulepreload" href="/vue-runtime-helpers.mjs">
  <link rel="modulepreload" href="/markdown-it.mjs">
  <link rel="modulepreload" href="/util.js">
  <!-- Avoid preloading conditional module "./menus.js" -->

  <!-- Embedd package.json -->
  <script type='application/json' id='--EMBEDD-package_json'>
  </script>

  <!--EMBEDD='index-mjs.list'-->

  <!-- Early setup of .CONFIG and .Electron globals -->
  <script>
    'use strict';
    if (window)
      {
	// Global configuration
	const CONFIG = { MAXINT: 2147483647, MAXUINT: 4294967295,              // plus delayed package.json values
			 dpr_movement: false, // Chrome bug, movementX *should* match screenX units
			 files: [], p: '', m: '', norc: false, uiscript: '' }; // defaults for non-Electron connections
	// Add package.json build info
	const packagejson = JSON.parse (document.getElementById ('--EMBEDD-package_json').innerHTML);
	Object.assign (CONFIG, packagejson.config);
	if (typeof module === 'object')
	  {
	    const Electron = require ('electron').remote;
	    if (Electron) // When running inside Electron, provide 'Electron' globally
	      {
		Object.defineProperty (window, 'Electron', { value: Electron });
		const win = Electron.getCurrentWindow();
		Object.assign (CONFIG, win.MAINCONFIG);
		const navigate_external = (ev, url) => {
		  if (ev.defaultPrevented) // <- main.js causes prevention
		    {
		      console.log ("NAVIGATE-EXTERNAL:", url);
		      Electron.shell.openExternal (url);
		    }
		};
		win.webContents.addListener ('will-navigate', navigate_external);
		win.webContents.addListener ('new-window', navigate_external);
		if (CONFIG.debug) // show DevTools on hotkey
		  document.addEventListener ("keydown", (event) => {
		    // Shift+Ctrl+I
		    if (event.shiftKey && event.ctrlKey && event.keyCode == 73)
		      Electron.getCurrentWindow().toggleDevTools();
		  });
	      }
	  }
	// Detect Chrome Bug: https://bugs.chromium.org/p/chromium/issues/detail?id=1092358 https://github.com/w3c/pointerlock/issues/42
	const chrome_major = parseInt (( /\bChrome\/([0-9]+)\./.exec (navigator.userAgent) || [0,0] )[1]);
	CONFIG.dpr_movement = chrome_major >= 37 && chrome_major <= 83;
	console.assert (chrome_major <= 83, `WARNING: Chrome/${chrome_major} has not been tested for the movementX devicePixelRatio bug`);
	// Provide globals: CONFIG, debug()
	Object.defineProperty (window, 'CONFIG', { value: CONFIG });
	Object.defineProperty (globalThis, 'debug', { value: (...a) => CONFIG.debug && console.log (...a), });
      }
  </script>

  <!-- Vue-Runtime.normalizeComponent is needed for SFC imports, see vue.rollup.js -->
  <script type="module">
  ( async _ => Object.defineProperty (globalThis, 'Vue-Runtime', { value: await import ('./vue-runtime-helpers.mjs') }) ) ();
  </script>

</head>
<body style="min-width: 320px; min-height: 320px"
      onload="(async _=> (await import ('./b/app.mjs')).default.bootup()) ()" >

  <!-- Application Vue mountpoint -->
  <b-app id="b-app" ></b-app>

  <!-- Embedded SVGs, hide but keep 'defs' element valid by not using display:none -->
  <div id='ebeast-embedded-svgs'
       style="position: fixed !important; width: 0 !important; height: 0 !important; overflow: hidden !important">
    <!--EMBEDD='eknob.svg'-->
  </div>

</body>
</html>
